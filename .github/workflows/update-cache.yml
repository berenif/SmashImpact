name: Update Cache Version

on:
  push:
    branches: [ main ]
    paths:
      - 'isometric-game.js'
      - 'multiplayer.js'
      - 'visual-effects.js'
      - '*.html'

jobs:
  update-cache:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Update cache version
      run: |
        # Generate version based on timestamp
        VERSION=$(date +%s)
        
        # Update game-iso.html with new version numbers
        sed -i "s/\?v=[0-9.]*/?v=$VERSION/g" game-iso.html
        
        echo "Updated cache version to: $VERSION"
    
    - name: Commit and push if changed
      run: |
        git config --global user.name 'GitHub Actions'
        git config --global user.email 'actions@github.com'
        git add -A
        git diff --staged --quiet || (git commit -m "Auto-update cache version to $(date +%s)" && git push)