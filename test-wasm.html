<!DOCTYPE html>
<html>
<head>
    <title>WASM Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        #status {
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
    </style>
</head>
<body>
    <h1>WASM Module Test</h1>
    <div id="status">Loading...</div>
    
    <script type="module">
        const statusDiv = document.getElementById('status');
        
        function log(message, type = 'info') {
            const p = document.createElement('p');
            p.className = type;
            p.textContent = message;
            statusDiv.appendChild(p);
            console.log(message);
        }
        
        async function testWASM() {
            try {
                log('Loading WASM module...', 'info');
                
                // Import the ES6 module
                const { default: GameEngineModule } = await import('./public/game_engine.js');
                
                log('Initializing WASM module...', 'info');
                
                // Initialize the module
                const Module = await GameEngineModule({
                    print: (text) => log(`[WASM]: ${text}`, 'info'),
                    printErr: (text) => log(`[WASM Error]: ${text}`, 'error'),
                    locateFile: (path) => {
                        if (path.endsWith('.wasm')) {
                            return './public/game_engine.wasm';
                        }
                        return path;
                    }
                });
                
                log('✅ WASM module loaded successfully!', 'success');
                
                // Test creating game engine
                log('Creating GameEngine instance...', 'info');
                const engine = new Module.GameEngine(1920, 1080);
                
                log('✅ GameEngine created successfully!', 'success');
                
                // Test some methods
                log('Testing GameEngine methods...', 'info');
                
                engine.init();
                log('- init() called', 'info');
                
                const entityId = engine.addEntity(100, 100, 10, 10, 20, "test");
                log(`- addEntity() returned ID: ${entityId}`, 'info');
                
                engine.update(0.016);
                log('- update() called', 'info');
                
                const state = engine.getGameState();
                log(`- getGameState() returned: ${JSON.stringify(state, null, 2)}`, 'info');
                
                const metrics = engine.getPerformanceMetrics();
                log(`- getPerformanceMetrics() returned: ${JSON.stringify(metrics, null, 2)}`, 'info');
                
                engine.cleanup();
                log('- cleanup() called', 'info');
                
                log('✅ All tests passed! WASM module is working correctly.', 'success');
                
            } catch (error) {
                log(`❌ Error: ${error.message}`, 'error');
                console.error(error);
            }
        }
        
        // Run the test
        testWASM();
    </script>
</body>
</html>