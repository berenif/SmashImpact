<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mobile WASM Test</title>
    <style>
        body { margin: 0; background: #222; color: white; font-family: Arial; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #info { position: fixed; top: 10px; left: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="info">Loading WASM...</div>
    <canvas id="gameCanvas"></canvas>
    
    <script src="public/mobile-wasm-bridge.js"></script>
    <script src="public/game_engine.js"></script>
    
    <script>
        let canvas, ctx, engine, mobileControls;
        
        async function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            try {
                // Load WASM module
                const Module = await GameEngineModule();
                
                // Create game engine
                engine = new Module.GameEngine(canvas.width, canvas.height);
                
                // Create player at center
                const playerId = engine.createPlayer(canvas.width / 2, canvas.height / 2);
                
                // Create some enemies
                for (let i = 0; i < 5; i++) {
                    engine.createEnemy(
                        Math.random() * canvas.width,
                        Math.random() * canvas.height,
                        2.0
                    );
                }
                
                // Setup mobile controls
                mobileControls = new MobileWASMBridge(canvas, engine);
                
                document.getElementById('info').innerHTML = 'WASM Loaded! Use joystick to move, buttons to attack/block/roll';
                
                // Start game loop
                requestAnimationFrame(gameLoop);
                
            } catch (error) {
                document.getElementById('info').innerHTML = 'Error: ' + error.message;
                console.error(error);
            }
        }
        
        function gameLoop() {
            // Update game
            engine.update(0.016); // 60 FPS
            
            // Clear canvas
            ctx.fillStyle = '#222';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Get all entities
            const entities = engine.getAllEntities();
            
            // Draw entities
            entities.forEach(entity => {
                if (entity.type === 0) { // Player
                    ctx.fillStyle = '#00ff00';
                    ctx.beginPath();
                    ctx.arc(entity.x, entity.y, entity.radius, 0, Math.PI * 2);
                    ctx.fill();
                } else if (entity.type === 1) { // Enemy
                    ctx.fillStyle = '#ff0000';
                    ctx.beginPath();
                    ctx.arc(entity.x, entity.y, entity.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            });
            
            // Render mobile controls
            if (mobileControls) {
                mobileControls.render(ctx);
            }
            
            requestAnimationFrame(gameLoop);
        }
        
        window.addEventListener('load', init);
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (mobileControls) {
                mobileControls.handleResize();
            }
        });
    </script>
</body>
</html>