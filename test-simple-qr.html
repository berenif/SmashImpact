<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Simple QR Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        canvas { border: 1px solid #ccc; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Simple QR Code Test</h1>
    
    <button onclick="testQR()">Generate QR Code</button>
    <button onclick="checkLibrary()">Check Library</button>
    <button onclick="testJsQR()">Test jsQR Library</button>
    
    <canvas id="qrCanvas" width="200" height="200"></canvas>
    
    <div id="status"></div>
    
    <script src="./vendor/qrcode.js"></script>
    
    <script>
        function checkLibrary() {
            const status = document.getElementById('status');
            
            if (typeof window.qrcode === 'function') {
                status.innerHTML = '<span class="success">✅ QR library loaded successfully</span>';
                console.log('QR library:', window.qrcode);
            } else {
                status.innerHTML = '<span class="error">❌ QR library not loaded</span>';
                console.error('QR library not found');
            }
        }
        
        function testQR() {
            const status = document.getElementById('status');
            const canvas = document.getElementById('qrCanvas');
            
            try {
                // Check if library is available
                if (typeof window.qrcode !== 'function') {
                    throw new Error('QR library not loaded');
                }
                
                // Create QR code
                const qr = window.qrcode(0, 'L');
                qr.addData('Hello World!');
                qr.make();
                
                const count = qr.getModuleCount();
                const scale = 4;
                const size = count * scale;
                
                // Set canvas size
                canvas.width = canvas.height = Math.max(200, size);
                const ctx = canvas.getContext('2d');
                
                // Clear canvas
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Center the QR code
                const offset = Math.floor((canvas.width - size) / 2);
                
                // Draw QR code
                for (let r = 0; r < count; r++) {
                    for (let c = 0; c < count; c++) {
                        ctx.fillStyle = qr.isDark(r, c) ? '#000' : '#fff';
                        ctx.fillRect(offset + c * scale, offset + r * scale, scale, scale);
                    }
                }
                
                status.innerHTML = '<span class="success">✅ QR code generated successfully!</span>';
                console.log('QR generated with', count, 'modules');
                
            } catch (error) {
                status.innerHTML = '<span class="error">❌ Error: ' + error.message + '</span>';
                console.error('QR generation error:', error);
            }
        }
        
        // Auto-check library on load
        window.addEventListener('load', checkLibrary);
        
        function testJsQR() {
            log('Testing jsQR library...');
            
            try {
                if (typeof window.jsQR !== 'function') {
                    log('❌ jsQR library not available', 'error');
                    return;
                }
                
                log('✅ jsQR library available');
                
                // Create a simple test image with known data
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 100;
                canvas.height = 100;
                
                // Draw a simple test pattern (not a real QR code, just for testing jsQR)
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, 100, 100);
                ctx.fillStyle = '#000';
                ctx.fillRect(20, 20, 60, 60);
                
                // Get image data
                const imageData = ctx.getImageData(0, 0, 100, 100);
                
                // Test jsQR detection
                const result = window.jsQR(imageData.data, imageData.width, imageData.height);
                
                if (result) {
                    log(`✅ jsQR detected something: ${result.data}`);
                } else {
                    log('✅ jsQR processed image (no QR detected, which is expected for test pattern)');
                }
                
                log('✅ jsQR library is working properly');
                
            } catch (error) {
                log(`❌ jsQR test failed: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }
    </script>
</body>
</html>