<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>QR Code Test</title>
    <style>
        body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        canvas { border: 1px solid #ccc; margin: 10px 0; }
        button { background: #007cba; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #005a87; }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 4px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Code Compatibility Test</h1>
        <p>This page tests QR code generation across different browsers.</p>
        
        <div>
            <label for="qrText">Enter text to encode:</label>
            <input type="text" id="qrText" value="Hello World! This is a test QR code.">
        </div>
        
        <div>
            <button onclick="generateQR()">Generate QR Code</button>
            <button onclick="testCompatibility()">Test Browser Compatibility</button>
        </div>
        
        <div id="status"></div>
        
        <canvas id="qrCanvas" width="300" height="300"></canvas>
        
        <h3>Browser Information:</h3>
        <div id="browserInfo"></div>
    </div>

    <script src="./vendor/qrcode.js"></script>
    <script>
        function showStatus(message, isSuccess) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = 'status ' + (isSuccess ? 'success' : 'error');
        }

        function generateQR() {
            try {
                const text = document.getElementById('qrText').value;
                if (!text) {
                    showStatus('Please enter some text', false);
                    return;
                }

                // Check if QR library is available
                if (typeof window.qrcode !== 'function') {
                    showStatus('QR library not loaded', false);
                    return;
                }

                const canvas = document.getElementById('qrCanvas');
                const ctx = canvas.getContext('2d');
                
                // Generate QR code
                const qr = window.qrcode(0, 'L');
                qr.addData(text);
                qr.make();
                
                const count = qr.getModuleCount();
                const scale = 8;
                const size = count * scale;
                
                canvas.width = canvas.height = Math.max(300, size);
                
                // Clear canvas
                ctx.fillStyle = '#fff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                const offset = Math.floor((canvas.width - size) / 2);
                
                // Draw QR code
                for (let r = 0; r < count; r++) {
                    for (let c = 0; c < count; c++) {
                        ctx.fillStyle = qr.isDark(r, c) ? '#000' : '#fff';
                        ctx.fillRect(offset + c * scale, offset + r * scale, scale, scale);
                    }
                }
                
                showStatus('QR code generated successfully!', true);
                
            } catch (error) {
                showStatus('Error generating QR code: ' + error.message, false);
                console.error('QR generation error:', error);
            }
        }

        function testCompatibility() {
            const tests = [];
            
            // Test WebRTC
            if (window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection) {
                tests.push('✅ WebRTC supported');
            } else {
                tests.push('❌ WebRTC not supported');
            }
            
            // Test Canvas
            if (document.createElement('canvas').getContext) {
                tests.push('✅ Canvas supported');
            } else {
                tests.push('❌ Canvas not supported');
            }
            
            // Test QR library
            if (typeof window.qrcode === 'function') {
                tests.push('✅ QR library loaded');
            } else {
                tests.push('❌ QR library not loaded');
            }
            
            // Test Promises
            if (window.Promise) {
                tests.push('✅ Promises supported');
            } else {
                tests.push('❌ Promises not supported');
            }
            
            // Test performance.now
            if (window.performance && window.performance.now) {
                tests.push('✅ performance.now supported');
            } else {
                tests.push('❌ performance.now not supported');
            }
            
            // Test requestAnimationFrame
            if (window.requestAnimationFrame) {
                tests.push('✅ requestAnimationFrame supported');
            } else {
                tests.push('❌ requestAnimationFrame not supported');
            }
            
            showStatus('Compatibility test completed. Check console for details.', true);
            console.log('Browser Compatibility Test Results:');
            tests.forEach(test => console.log(test));
        }

        function showBrowserInfo() {
            const info = document.getElementById('browserInfo');
            const userAgent = navigator.userAgent;
            const platform = navigator.platform;
            const language = navigator.language;
            
            info.innerHTML = `
                <p><strong>User Agent:</strong> ${userAgent}</p>
                <p><strong>Platform:</strong> ${platform}</p>
                <p><strong>Language:</strong> ${language}</p>
                <p><strong>Cookies Enabled:</strong> ${navigator.cookieEnabled}</p>
                <p><strong>Online:</strong> ${navigator.onLine}</p>
            `;
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            showBrowserInfo();
            
            // Auto-generate QR code on page load
            setTimeout(generateQR, 500);
        });
    </script>
</body>
</html>