<!DOCTYPE html>
<html>
<head>
    <title>WASM Module Quick Tests</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5;
        }
        h1 {
            color: #333;
        }
        .pass { 
            color: green; 
            font-weight: bold;
        }
        .fail { 
            color: red; 
            font-weight: bold;
        }
        .result { 
            margin: 10px 0; 
            padding: 10px; 
            background: white;
            border-left: 4px solid #ccc;
            border-radius: 4px;
        }
        .result.pass {
            border-left-color: green;
        }
        .result.fail {
            border-left-color: red;
        }
        button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
        }
        button:hover {
            background: #45a049;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <h1>üß™ WASM Module Quick Tests</h1>
    <button onclick="runTests()">Run Tests</button>
    <div id="results"></div>

    <script src="public/game_engine.js"></script>
    <script>
        async function runTests() {
            const results = document.getElementById('results');
            results.innerHTML = '<h2>Running tests...</h2>';
            
            // Wait for module to be ready
            if (typeof Module === 'undefined') {
                results.innerHTML = '<div class="fail">‚ùå WASM Module not loaded!</div>';
                return;
            }
            
            await new Promise(resolve => {
                if (Module.calledRun) {
                    resolve();
                } else {
                    Module.onRuntimeInitialized = resolve;
                }
            });
            
            let passed = 0;
            let failed = 0;
            let output = '';
            
            // Test 1: Create Player
            try {
                const playerId = Module._createPlayer(400, 300);
                if (playerId >= 0) {
                    output += '<div class="result pass">‚úÖ Create Player - PASSED (ID: ' + playerId + ')</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Create Player - FAILED</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Create Player - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 2: Create Enemy
            try {
                const enemyId = Module._createEnemy(100, 100, 2.0);
                if (enemyId >= 0) {
                    output += '<div class="result pass">‚úÖ Create Enemy - PASSED (ID: ' + enemyId + ')</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Create Enemy - FAILED</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Create Enemy - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 3: Create Wolf
            try {
                const wolfId = Module._createWolf(200, 200);
                if (wolfId >= 0) {
                    output += '<div class="result pass">‚úÖ Create Wolf - PASSED (ID: ' + wolfId + ')</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Create Wolf - FAILED</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Create Wolf - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 4: Entity Count
            try {
                const count = Module._getEntityCount();
                if (count >= 0) {
                    output += '<div class="result pass">‚úÖ Get Entity Count - PASSED (Count: ' + count + ')</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Get Entity Count - FAILED</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Get Entity Count - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 5: Clear Entities
            try {
                Module._clearEntities();
                const count = Module._getEntityCount();
                output += '<div class="result pass">‚úÖ Clear Entities - PASSED (Remaining: ' + count + ')</div>';
                passed++;
            } catch (e) {
                output += '<div class="result fail">‚ùå Clear Entities - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 6: Game Update
            try {
                Module._updateGame(16);
                output += '<div class="result pass">‚úÖ Update Game Loop - PASSED</div>';
                passed++;
            } catch (e) {
                output += '<div class="result fail">‚ùå Update Game Loop - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 7: Score Management
            try {
                Module._setScore(100);
                const score = Module._getScore();
                if (score === 100) {
                    output += '<div class="result pass">‚úÖ Score Management - PASSED (Score: ' + score + ')</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Score Management - Expected 100, got ' + score + '</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Score Management - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 8: Wave Management
            try {
                Module._setWave(1);
                const wave = Module._getWave();
                if (wave === 1) {
                    output += '<div class="result pass">‚úÖ Wave Management - PASSED (Wave: ' + wave + ')</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Wave Management - Expected 1, got ' + wave + '</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Wave Management - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 9: Pause/Resume
            try {
                Module._pauseGame();
                const isPaused = Module._isGamePaused();
                Module._resumeGame();
                const isResumed = !Module._isGamePaused();
                
                if (isPaused && isResumed) {
                    output += '<div class="result pass">‚úÖ Pause/Resume - PASSED</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Pause/Resume - FAILED</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Pause/Resume - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Test 10: Projectile Creation
            try {
                const playerId = Module._createPlayer(400, 300);
                const projectileId = Module._createProjectile(400, 300, 1.0, 0.0, 10, playerId);
                if (projectileId >= 0) {
                    output += '<div class="result pass">‚úÖ Create Projectile - PASSED (ID: ' + projectileId + ')</div>';
                    passed++;
                } else {
                    output += '<div class="result fail">‚ùå Create Projectile - FAILED</div>';
                    failed++;
                }
            } catch (e) {
                output += '<div class="result fail">‚ùå Create Projectile - ERROR: ' + e + '</div>';
                failed++;
            }
            
            // Summary
            const total = passed + failed;
            const percentage = ((passed / total) * 100).toFixed(1);
            
            output = '<h2>Test Results</h2>' + output;
            output += '<div class="summary">';
            output += '<h3>üìä Summary</h3>';
            output += '<div>Total Tests: <strong>' + total + '</strong></div>';
            output += '<div class="pass">Passed: ' + passed + '</div>';
            output += '<div class="fail">Failed: ' + failed + '</div>';
            output += '<div>Success Rate: <strong>' + percentage + '%</strong></div>';
            
            if (failed === 0) {
                output += '<h2 class="pass">üéâ All tests passed! WASM module is working correctly.</h2>';
            } else {
                output += '<h2 class="fail">‚ö†Ô∏è Some tests failed. Check the WASM module.</h2>';
            }
            output += '</div>';
            
            results.innerHTML = output;
        }
        
        // Auto-run tests when module loads
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>